define(["util","selector"],function(e,t){function n(){e.click(t(".btn3")[1],h);var n=t(".t-content-tittle .task-text"),l=t(".t-content-date .task-text"),a=t(".t-content-detail .myTextArea");n.value="",l.value="",a.value="",t(".t-content-tittle span")[0].style.display="none",t(".t-content-date span").style.display="none",t(".t-content-detail span").style.display="none",n.style.display="inline-block",l.style.display="inline-block",a.style.display="inline-block",t(".btn3")[0].style.display="inline-block",t(".btn3")[1].style.display="inline-block"}function l(){t(".pop").style.display="none",t(".overlay").style.display="none",t(".pop-content").innerHTML=""}function a(){var e=t(".pop-content .new-task-name").value,n=t(".error"),a=t(".cat-sel").value;if(0!==e.length)if(e.length>10)n.innerHTML="您输入内容超过10个字符";else if(y(x,"name",e))n.innerHTML="您输入分类已经存在";else if(y(B,"name",e))n.innerHTML="您输入子分类已经存在";else{if("-1"===a){var i={id:x[x.length-1].id+1,name:e,child:[]};x.push(i)}else{var s=y(x,"id",x[a].id),o={id:B[B.length-1].id+1,name:e,child:[],father:s.id};s.child.push(o.id),B.push(o)}E(),l(),L(H)}else n.innerHTML="您输入内容为空"}function i(){t(".pop").style.display="block",t(".overlay").style.display="block";var n="";n+='<div>任务名称:<input type="text" class="new-task-name new-task-name-p" placeholder="输入新任务名称"></div><div>任务目录:<select class="cat-sel cat-sel-p"><option value="-1">无</option>';for(var i=t("#t-list-detail h4"),s=0;s<i.length;s++)n+='<option value="'+s+'">'+i[s].getElementsByTagName("span")[0].innerHTML+"</option>";n+='</select></div><div class="error"></div><button class="pop-btn btn1">取消</button><button class="pop-btn btn2">确定</button>',t(".pop-content").innerHTML=n,e.click(t(".btn1"),l),e.click(t(".btn2"),a)}function s(n){"span"===(n=n.target||n.srcElement).tagName.toLowerCase()&&(n=n.parentNode);for(var l=t(".t-list").getElementsByTagName("*"),a=0;a<l.length;a++)e.hasClass(l[a],"choose")&&e.removeClass(l[a],"choose");n&&e.addClass(n,"choose"),N(H)}function o(){var e=y(C,"name",t(".t-content-tittle span")[0].innerHTML);if(e){if(e.finish)return void alert("任务已经完成！");if(!confirm("确定要设置任务为已完成状态吗？"))return;e.finish=!0,E(),N(e.id)}}function c(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2f;").replace(/`/g,"&#x60;")}function r(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2f;/g,"/").replace(/&#x60;/g,"`")}function d(){if(t(".t-content-tittle span")[0].innerHTML){var n=t(".t-content-date .task-text"),l=t(".t-content-detail .myTextArea");e.click(t(".btn3")[1],p),t(".t-content-date .task-text").value=r(t(".t-content-tittle span")[0].innerHTML),n.value=t(".t-content-date span").innerHTML,l.value=r(t(".t-content-detail span").innerHTML),t(".t-content-date span").style.display="none",t(".t-content-detail span").style.display="none",n.style.display="inline-block",l.style.display="inline-block",t(".btn3")[0].style.display="inline-block",t(".btn3")[1].style.display="inline-block"}}function h(){var n=t(".t-content-tittle .task-text"),l=t(".t-content-date .task-text"),a=t(".t-content-detail .myTextArea"),i=c(n.value),s=l.value,o=c(a.value);if(0!==i.length)if(y(C,"name",i))t(".taskError").innerHTML="任务名字已经存在";else if(s.match(/^\d{4}-\d{2}-\d{2}$/)){var r=s.split("-");if(r[1]<1||r[1]>12||r[2]<1||r[2]>31)t(".taskError").innerHTML="任务日期有错，根本没有这一天";else{t(".t-content-tittle span")[0].innerHTML=i,t(".t-content-date span").innerHTML=s,t(".t-content-detail span").innerHTML=o;var d,p=t(".t-list-wrap h3")[0];if(e.hasClass(p,"choose"))d=y(B,"id",x[0].child[0]);else{var g,m=t(".t-list-wrap h4");for(g=0;g<m.length&&!e.hasClass(m[g],"choose");g++);if(g<m.length){var f=y(x,"name",m[g].getElementsByTagName("span")[0].innerHTML);d=0===f.child.length?y(B,"id",x[0].child[0]):y(B,"id",f.child[0])}else{var u=t(".t-list-wrap h5");for(g=0;g<u.length&&!e.hasClass(u[g],"choose");g++);g===u.length||(d=y(B,"name",u[g].getElementsByTagName("span")[0].innerHTML))}}console.log(d);var k={id:C[C.length-1].id+1,name:i,father:d.id,finish:!1,date:s,content:o};C.push(k),d.child.push(k.id),t(".t-content-tittle span")[0].style.display="inline-block",t(".t-content-date span").style.display="inline-block",t(".t-content-detail span").style.display="inline-block",n.style.display="none",l.style.display="none",a.style.display="none",t(".btn3")[0].style.display="none",t(".btn3")[1].style.display="none",t(".taskError").innerHTML="",E(),L(k.id),e.unclick(t(".btn3")[1],h)}}else t(".taskError").innerHTML="任务日期格式错误";else t(".taskError").innerHTML="任务名字为空"}function p(){var n=t(".t-content-date .task-text"),l=t(".t-content-detail .myTextArea"),a=n.value,i=c(l.value);if(a.match(/^\d{4}-\d{2}-\d{2}$/)){var s=a.split("-");if(s[1]<1||s[1]>12||s[2]<1||s[2]>31)t(".taskError").innerHTML="任务日期有错，根本没有这一天";else{t(".t-content-date span").innerHTML=a,t(".t-content-detail span").innerHTML=i;var o=t(".t-content-tittle span")[0].textContent,r=y(C,"name",c(o));r.date=a,r.content=i,t(".t-content-date span").style.display="inline-block",t(".t-content-detail span").style.display="inline-block",n.style.display="none",l.style.display="none",t(".btn3")[0].style.display="none",t(".btn3")[1].style.display="none",t(".taskError").innerHTML="",E(),N(r.id),e.unclick(t(".btn3")[1],p)}}else t(".taskError").innerHTML="任务日期格式错误"}function g(){var e=t(".t-content-date .task-text"),n=t(".t-content-detail .myTextArea");t(".taskError").innerHTML="",t(".t-content-date span").style.display="inline-block",t(".t-content-detail span").style.display="inline-block",e.style.display="none",n.style.display="none",t(".btn3")[0].style.display="none",t(".btn3")[1].style.display="none"}function m(t){"span"===(t=t.target||t.srcElement).tagName.toLowerCase()&&(t=t.parentNode);for(var n=t.parentNode.parentNode.parentNode.parentNode.getElementsByTagName("*"),l=0;l<n.length;l++)e.hasClass(n[l],"choose")&&e.removeClass(n[l],"choose");e.addClass(t,"choose"),k(t)}function y(e,t,n){for(var l=0;l<e.length;l++)if(e[l][t]===n)return e[l];return null}function f(e,t,n){for(var l=0;l<e.length;l++)if(e[l][t]===n)return l;return M}function u(e){return e.sort(function(e,t){return e.replace(/-/g,"")-t.replace(/-/g,"")})}function k(e){if(e){var n=c(e.getElementsByClassName("detail-text")[0].textContent),l=y(C,"name",n);t(".t-content-tittle span")[0].innerHTML=l.name,t(".t-content-date span").innerHTML=l.date,t(".t-content-detail span").innerHTML=l.content,t(".set-text").style.display="block"}else t(".t-content-tittle span")[0].innerHTML="",t(".t-content-date span").innerHTML="",t(".t-content-detail span").innerHTML="",t(".set-text").style.display="none"}function v(t){if(null!==t){for(var n=(t=t.target||t.srcElement).parentNode,l=0;l<n.children.length;l++)e.hasClass(n.children[l],"choose")&&e.removeClass(n.children[l],"choose");e.addClass(t,"choose");var a=t.innerHTML;nodes=document.getElementsByClassName("status-item");for(l=0;l<nodes.length;l++){if(nodes[l].style.display="block",nodesFinish=nodes[l].getElementsByClassName("task-finish"),nodesFinish)for(i=0;i<nodesFinish.length;i++)nodesFinish[i].parentNode.style.display="block";if(nodesFinish=nodes[l].getElementsByClassName("task-unfinish"),nodesFinish)for(i=0;i<nodesFinish.length;i++)nodesFinish[i].parentNode.style.display="block"}if(-1!==a.indexOf("所有"));else if(-1!==a.indexOf("未完成")){for(l=0;l<nodes.length;l++)if(nodesFinish=nodes[l].getElementsByClassName("task-finish"),nodesLi=nodes[l].getElementsByTagName("li"),nodesFinish.length)if(nodesFinish.length===nodesLi.length)nodes[l].style.display="none";else for(i=0;i<nodesFinish.length;i++)nodesFinish[i].parentNode.style.display="none"}else if(-1!==a.indexOf("已完成"))for(l=0;l<nodes.length;l++)if(nodesFinish=nodes[l].getElementsByClassName("task-unfinish"),nodesLi=nodes[l].getElementsByTagName("li"),nodesFinish.length)if(nodesFinish.length===nodesLi.length)nodes[l].style.display="none";else for(var i=0;i<nodesFinish.length;i++)nodesFinish[i].parentNode.style.display="none";for(var s=document.getElementsByTagName("h6"),l=0;l<s.length;l++)if("none"!==s[l].parentNode.parentNode.parentNode.style.display){s[l].click();break}}}function T(n,l){var a=[],i=[],s="";if(p=document.getElementsByTagName("h6"))for(d=0;d<p.length;d++)e.unclick(p[d],m);if(p=document.getElementsByClassName("t-status-choose")[0].getElementsByClassName("delete"))for(d=0;d<p.length;d++)e.unclick(p[d],b);for(d=0;d<n.length;d++){var o=y(C,"id",n[d]);i.push(o),a.push(o.date)}a=u(a=e.uniqArray1(a));for(var c=0,r=!1,d=0;d<a.length;d++){s+='<li class="status-item"><h5>'+a[d]+"</h5><ul>";for(var h=0;h<i.length;h++)i[h].date===a[d]&&(!0===i[h].finish?s+='<li><h6 class="task-finish">':s+='<li><h6 class="task-unfinish">',s+='<i class="icon-check"></i><span class="detail-text">'+i[h].name+'</span><i class="delete icon-minus-circled"></i></h6></li>',!1===r&&(l===i[h].id?r=!0:c++));s+="</ul></li>"}t(".t-status-choose").innerHTML=s;for(var p=document.getElementsByTagName("h6"),d=0;d<p.length;d++)e.click(p[d],m);for(var p=document.getElementsByClassName("t-status-choose")[0].getElementsByClassName("delete"),d=0;d<p.length;d++)e.click(p[d],b);return!1===r?0:c}function N(e){var n=t(".t-status-choose .choose");t(".t-status-sel li")[0].click();var l=t(".t-list-wrap .choose"),a=[];if(l)switch(l.tagName.toLowerCase()){case"h3":for(p=0;p<C.length;p++)a.push(C[p].id);T(a,e);break;case"h4":o=l.getElementsByTagName("span")[0].innerHTML;if(c=y(x,"name",o))for(p=0;p<c.child.length;p++)for(var i=y(B,"id",c.child[p]),s=0;s<i.child.length;s++)a.push(i.child[s]);T(a,e);break;case"h5":var o=l.getElementsByTagName("span")[0].innerHTML,c=y(B,"name",o);if(c)for(p=0;p<c.child.length;p++)a.push(c.child[p]);T(a,e)}if(a.length)if(n)for(var r=document.getElementsByTagName("h6"),d=n.getElementsByTagName("span")[0].innerHTML,h=!1,p=0;p<r.length;p++){if(r[p].getElementsByTagName("span")[0].innerHTML===d){r[p].click(),h=!0;break}!h&&t("h6")&&document.getElementsByTagName("h6")[0].click()}else t("h6")&&document.getElementsByTagName("h6")[0].click();else k(null)}function b(e){if(confirm("删除操作不可逆，确定要删除吗？")){var t=(e=e.target||e.srcElement).target.parentNode,n=t.getElementsByTagName("span")[0].innerHTML;switch(t.tagName.toLowerCase()){case"h4":index=f(x,"name",n);for(i=0;i<x[index].child.length;i++){for(var l=f(B,"id",x[index].child[i]),a=0;a<B[l].child.length;a++){s=f(C,"id",B[l].child[a]);C.splice(s,1)}B.splice(l,1)}x.splice(index,1);break;case"h5":index=f(B,"name",n);for(var i=0;i<B[index].child.length;i++){var s=f(C,"id",B[index].child[i]);C.splice(s,1)}(o=y(x,"id",B[index].father)).child.splice(o.child.indexOf(B[index].id),1),B.splice(index,1);break;case"h6":index=f(C,"name",n);var o=y(B,"id",C[index].father);o.child.splice(o.child.indexOf(C[index].id),1),C.splice(index,1)}E(),L(H)}}function L(n){t(".t-status-choose .choose");var l=t(".t-list-wrap .choose");t("#t-list-all").innerHTML="<span>所有任务</span>("+C.length+")";for(var a="",i=0;i<x.length;i++){for(var o=0,c=x[i],r=0;r<c.child.length;r++)o+=B[f(B,"id",c.child[r])].child.length;a+="<li><h4>",a+="<span>"+x[i].name+"</span>("+o+")",a+='<i class="delete icon-minus-circled"></i>',a+='</h4><ul class="t-list-item">';for(var d=0;d<B.length;d++)x[i].id===B[d].father&&(a+="<li><h5>",a+="<span>"+B[d].name+"</span>("+B[d].child.length+")",a+='<i class="delete icon-minus-circled"></i>',a+="</h5></li>");a+="</ul></li>"}a=(a=a.replace(/<i class="delete icon-minus-circled"><\/i>/,"")).replace(/<i class="delete icon-minus-circled"><\/i>/,""),t("#t-list-detail").innerHTML=a;for(var h=t("#t-list-detail").getElementsByTagName("h4"),i=0;i<h.length;i++)e.click(h[i],s);for(var h=t("#t-list-detail").getElementsByTagName("h5"),i=0;i<h.length;i++)e.click(h[i],s);for(var h=t("#t-list-detail").getElementsByClassName("delete"),i=0;i<h.length;i++)e.click(h[i],b);if(l){var p=l.tagName.toLowerCase(),g=l.getElementsByTagName("span")[0].innerHTML,m=!1;switch(p){case"h3":document.getElementsByTagName("h3")[0].click(),m=!0;break;case"h4":for(var y=t("#t-list-detail").getElementsByTagName("h4"),i=0;i<y;i++)if(g===y[i].getElementsByTagName("span")[0].innerHTML){y[i].click(),m=!0;break}break;case"h5":for(var u=t("#t-list-detail").getElementsByTagName("h5"),i=0;i<u;i++)if(g===u[i].getElementsByTagName("span")[0].innerHTML){u[i].click(),m=!0;break}}m||t("h3")[0].click()}else t("h3")[0].click()}function E(){localStorage.getItem("cat1")&&(localStorage.setItem("cat1",JSON.stringify(x)),localStorage.setItem("cat2",JSON.stringify(B)),localStorage.setItem("cat3",JSON.stringify(C)))}var H=4294967295,M=4294967295,x=[{id:0,name:"默认分类",child:[0]},{id:1,name:"默认分类2",child:[1,2]}],B=[{id:0,name:"默认子分类",child:[0,1],father:0},{id:1,name:"默认子分类21",child:[],father:1},{id:2,name:"默认子分类22",child:[],father:1}],C=[{id:0,name:"to-do 1",father:0,finish:!0,date:"2015-05-28",content:"开始 task0001 的编码任务。"},{id:1,name:"to-do 3",father:0,finish:!1,date:"2015-05-30",content:"完成 task0001 的编码任务。"}];return{init:function(){localStorage.getItem("cat1")?(x=JSON.parse(localStorage.getItem("cat1")),B=JSON.parse(localStorage.getItem("cat2")),C=JSON.parse(localStorage.getItem("cat3"))):(localStorage.setItem("cat1",JSON.stringify(x)),localStorage.setItem("cat2",JSON.stringify(B)),localStorage.setItem("cat3",JSON.stringify(C)));t("#t-list-all");e.addClass(t("#t-list-all"),"choose"),e.click(t("#t-list-all"),s),e.click(t(".t-list-add"),i),e.click(t(".t-status-sel li")[0],v),e.click(t(".t-status-sel li")[1],v),e.click(t(".t-status-sel li")[2],v),e.click(t(".icon-done"),o),e.click(t(".icon-edit"),d),e.click(t(".btn3")[0],g),e.click(t(".t-status-add"),n),L(H)}}});
//# sourceMappingURL=gtd.js.map
